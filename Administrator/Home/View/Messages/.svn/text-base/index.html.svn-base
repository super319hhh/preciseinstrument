<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>新闻管理</title>
		<!--CSS-->
		<link rel="shortcut icon" href="favicon.ico"> 
	    <link href="__HADMIN__/css/font-awesome.min.css?v=4.4.0" rel="stylesheet">
	    <link href="__HADMIN__/css/animate.css" rel="stylesheet">
	    <link href="__HADMIN__/css/style.css?v=4.1.0" rel="stylesheet">
		<link href="__HADMIN__/css/plugins/dataTables/jquery.dataTables.min.css" rel="stylesheet"/>
		<link href="__HADMIN__/css/bootstrap.min.css" rel="stylesheet">
		<link href="__HADMIN__/js/plugins/SweetAlert2/dist/sweetalert2.min.css" rel="stylesheet" />
		<link href="__HADMIN__/css/plugins/select2/css/select2.min.css" rel="stylesheet" />
		<!--JS-->
	    <script src="__HADMIN__/js/jquery.min.js?v=2.1.4"></script>
	    <script src="__HADMIN__/js/bootstrap.min.js?v=3.3.6"></script>
	    <script src="__HADMIN__/js/plugins/metisMenu/jquery.metisMenu.js"></script>
	    <script src="__HADMIN__/js/plugins/layer/layer.min.js"></script>
		<!--databales-->
		<script src="__HADMIN__/js/plugins/dataTables/jquery.dataTables.min.js"></script>
		<script src="__HADMIN__/js/plugins/dataTables/dataTables.bootstrap.js"></script>
		<script src="__HADMIN__/js/plugins/SweetAlert2/dist/sweetalert2.min.js" type="text/javascript"></script>
		<script src="__HADMIN__/js/plugins/select2/js/select2.full.js"></script>
		<include file="Home@Layout/preFunction" />
	</head>
	
	<body>
		

	<div class="container-fluid wrapper wrapper-content">			
		<div class="row">
			<div class="ibox">
			    <div class="ibox-title" style="height: 65px;">
			        <h1>留言管理</h1>
			    </div>
			</div>
		</div><!--.row面包屑导航-->
		<div class="row wrapper wrapper-content " >
			<div class="">
				<table class="table table-bordered table-hover  table-striped" id="messages" style="">
					<thead>
						<tr style="font-size: 16px;">
							<th width="10%" style="text-align:center;">主题</th>
							<th width="20%" style="text-align:center;">留言内容</th>
							<th width="5%" style="text-align:center;">留言人</th>
							<th width="8%" style="text-align:center;">电话</th>
							<th width="9%"  style="text-align:center;">邮箱</th>
							<th width="10%" style="text-align:center;">公司</th>
							<th width="9%"  style="text-align:center;">地址</th>
							<th width="9%"  style="text-align:center;">备注</th>
							<th width="7%"  style="text-align:center;">添加备注</th>
							<th width="7%"  style="text-align:center;">状态</th>
							<th width="7%"  style="text-align:center;">操作</th>
						</tr>
					</thead>
					<tbody>
					</tbody>
				</table>
<!--详情-->
			<div class="modal fade" id="xiangxi"   tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
					<div class="modal-dialog"style="width: 60%;">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal"
										aria-hidden="true">×
								</button>
								<h2 class="modal-title" id="myModalLabel">
									详情
								</h2>
							</div>
							<div class="modal-body">
									<div id="passage" style="padding: 20px;">
									</div>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-danger" data-dismiss="modal">
									关闭
								</button>
							</div>
						</div><!-- /.modal-content -->
					</div><!-- /.modal-dialog -->
				</div>
<!--备注-->				
			<div class="modal fade" id="edit-mdol" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
					<div class="modal-dialog"style="width: 55%;">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal"
										aria-hidden="true">×
								</button>
								<h2 class="modal-title" id="myModalLabel">
									编辑备注
								</h2>
							</div>
							<div class="modal-body">
								<div class="" style="width: 100%; height: 300px;">
									<div class="row col-lg-12" style="font-size: 20px; margin-bottom: 1.2em; padding-left: 2.5em; padding-top: 1em;" >
										<textarea name="" rows="9" cols="80" id="lywb"></textarea>
									</div>
								</div>
							</div>
							<input id="Fruit" type="hidden"/> 
							<div class="modal-footer">
								<button type="button" class="btn btn-success" data-dismiss="modal" id="add-suss-x">
									确定
								</button>
								<button type="button" class="btn btn-danger" data-dismiss="modal">
									关闭
								</button>
							</div>
						</div><!-- /.modal-content -->
					</div><!-- /.modal-dialog -->
				</div>
<script type="text/javascript">
	 var messages;
	 $(document).ready(function() {
			var tableHeight = document.body.clientHeight * 0.6 + 'px';
			$("#messages").dataTable({
				"bProcessing": true,
				"sPaginationType": "full_numbers",
				"scrollY": tableHeight,
				"ordering": false,
				/*自定义语言*/
				"oLanguage": {
					"sProcessing": "正在加载数据...",
					"sLengthMenu": "每页显示 _MENU_ 条记录",
					"sZeroRecords": "抱歉， 没有找到",
					"sInfo": "从 _START_ 到 _END_ /共 _TOTAL_ 条数据",
					"sInfoEmpty": "",
					"sInfoFiltered": "(从 _MAX_ 条数据中检索)",
					"oPaginate": {
						"sFirst": "首页",
						"sPrevious": "前一页",
						"sNext": "后一页",
						"sLast": "尾页"
					},
					"sZeroRecords": "还没新的留言！",
					"sSearch": "搜索",
				},
				/*请求方法*/
				"ajax":{
					"url":"__URL__/getmessages",
					"data":'sdasd',
				},
				/*向后台传参*/
				"fnServerParams": function(aoData) {
					aoData.push({
						"name": "name",
						"value": "value"
					});
				},
				"fnRowCallback": function (nRow, aaData, iDisplayIndex) {
			            if (aaData.message.length > 18) {
			                $('td:eq(1)', nRow).html( aaData.message.substr(0, 18)+'....'+'<a href="#xiangxi" id="xiangx" data-toggle="modal" attrid="' + aaData.message_id + '">查看</a>');
			            }
			            if ( aaData.address !==null && aaData.address.length > 8) {
			                $('td:eq(6)', nRow).html( aaData.address.substr(0, 6)+'....'+'<a href="#xiangxi" id="xxdz" data-toggle="modal" attrid="' + aaData.message_id + '">查看</a>');
			            }
			            if ( aaData.remark !==null &&  aaData.remark.length > 8) {
			                $('td:eq(7)', nRow).html( aaData.remark.substr(0, 6)+'....'+'<a href="#xiangxi" id="tjbz" data-toggle="modal" attrid="' + aaData.message_id + '">查看</a>');
			            }
			       },
				"aoColumns": [
					{"mData": "theme"},
					{
						"mData": "message",
					},
					{
						"mData": "name",
						'sClass': "text-center",
					},
					{
						"data": "contact",
						'sClass': "text-center",
						"render": function(data, type, full, meta){
							if(full.contact==null) {
								return data = '<span style="color: #6FB6C4;">未填写</span>'          
							}else{
								return data;
							}
						}
					},
					{
						"mData": "mail",
					},
					
					{
						"data": "company",
						"render": function(data, type, full, meta){
							if(full.company==null) {
								return data = '<span style="color: #6FB6C4;">未填写</span>'          
							}else{
								return data;
							}
						}
					},
					{
						"data": "address",
						"render": function(data, type, full, meta){
							if(full.address==null) {
								return data = '<span style="color: #6FB6C4;">未填写</span>'          
							}else{
								return data;
							}
						}
					},
					{
						"data": "remark",
						"render": function(data, type, full, meta){
							if(full.remark==null) {
								return data = '<span style="color: #6FB6C4;">无备注</span>'          
							}else{
								return data;
							}
						}
					},
					{
						"data": "message_id",
						'sClass': "text-center",
						"render": function(data, type, full, meta){
							return data = '<button type="button" class="btn btn-info"  id="add"  href="#edit-mdol"  data-toggle="modal" attrid="' + data +'">备注</button>' 
						}
					},
					{
						"data": "message_id",
						'sClass': "text-center",
						"render": function(data, type, full, meta){
							if(full.is_read == 'N' ) {
								return data = '<button type="button" class="btn btn-warning"   id="show-caocuo" attrid="' + data +'">标为已读</button>'          
							}else if(full.is_read == 'Y'){
								return data = '<button type="button" class="btn btn-success"  >已读</button>'             
							}
						}
					},
					{
						"data": "message_id",
						'sClass': "text-center",
						"render": function(data, type, full, meta){
							return data = '<button type="button" class="btn btn-danger"  id="drop" attrid="' + data +'">删除</button>' 
						}
					},
				],
			});
		});
		
//删除
	$('.table').on('click','#drop',function(){
		var id=$(this).attr('attrid');
		swal({
        title: '确定删除?',
        text: "",
        type:'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: '确认',
	    cancelButtonText: '取消',
        }).then(function(isConfirm) {
            if(isConfirm) {
				loading.add();
            	$.ajax({
		            type: "get",
		            url: "__URL__/drop",
		            data: {dadel:id},
		            success: function (data) {
		            	if(data==true){
		            		swal("删除成功!", "", "success").then(function(isConfirm) {
				             		location.reload(true);
			            	})
				     		loading.remove();
						}else{
				     		sweetAlert(
							  '出错了...',
							  '删除失败!',
							  'error'
							)
				     		loading.remove();
				     	}
		            },
    			});
    	    }
       })
	})
//已读
	$('.table').on('click','#show-caocuo',function(){
		var id=$(this).attr('attrid');
		loading.add();
    	$.ajax({
            type: "get",
            url: "__URL__/read",
            data: {dadel:id},
            success: function (data) {
            	if(data==true){
            		swal("操作成功!", "", "success").then(function(isConfirm) {
		             		location.reload(true);
	            	})
				loading.remove();
				}else{
		     		sweetAlert(
					  '出错了...',
					  '操作失败!',
					  'error'
					)
				loading.remove();
		     	}
            },
		});
	})	
//查看内容详细信息
	$('.table').on('click','#xiangx',function(){
		var id=$(this).attr('attrid');
		$.ajax({
            type: "get",
            url: "__URL__/show",
            data: {dataid:id},
            success: function (data) {
             	if(data){
	               $("#passage").append(data);
	               loading.remove();
             	}else{
             		swal(
					  '出错了...',
					  '连接失败!',
					  'error'
					)
             	}
             	loading.remove();
            },
    	});
	})
	$('.table').on('click','#xxdz',function(){
			var id=$(this).attr('attrid');
			loading.add();
			$.ajax({
	            type: "get",
	            url: "__URL__/showdz",
	            data: {dataid:id},
	            success: function (data) {
	             	if(data){
		               $("#passage").append(data);
		               loading.remove();
	             	}else{
	             		swal(
						  '出错了...',
						  '连接失败!',
						  'error'
						)
	             		loading.remove();
	             	}
	             	loading.remove();
	            },
	    	});
		})
	$('.table').on('click','#tjbz',function(){
			var id=$(this).attr('attrid');
			loading.add();
			$.ajax({
	            type: "get",
	            url: "__URL__/showbz",
	            data: {dataid:id},
	            success: function (data) {
	             	if(data){
		               $("#passage").append(data);
		               loading.remove();
	             	}else{
	             		swal(
						  '出错了...',
						  '连接失败!',
						  'error'
						)
	             		loading.remove();
	             	}
	             	loading.remove();
	            },
	    	});
		})
//获取备注数据
	$('.table').on('click','#add',function(){
		var id=$(this).attr('attrid');
		loading.add();
        	$.ajax({
	            type: "get",
	            url: "__URL__/adddata",
	            data: {'dadel':id},
	            dataType:'JSON ',
	            success: function (data) {
	            	$("#lywb").val(data.remark);
	            	$("#Fruit").attr('value',data.message_id);
	            	loading.remove();
	            },
			});
       })
//修改
	$('#add-suss-x').click(function(){
		var xid=$("#Fruit").val();
		var xcont=$("#lywb").val();
		loading.add();
		$.ajax({
			type:"get",
			url:"__URL__/edit",
			data:{
				'xid':xid,
				'xdatt':xcont,
			},
			success:function(data){
				if(data==true){
         			swal("操作成功!", "", "success").then(function(isConfirm) {
		             		location.reload(true);
	            	})
         			loading.remove();
             	}else{
             		swal(
					  '出错了...',
					  '操作失败!',
					  'error'
					)
             		loading.remove();
             	}
			}
		});
	})	
//清空展示模态框
	$('#xiangxi').on('hidden.bs.modal', function (e) {
		  $("#passage").empty();
	})	
</script>
	</body>
</html>
