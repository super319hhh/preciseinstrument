<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="renderer" content="webkit">

    <title> 谱祥伟业科技 </title>

    <meta name="keywords" content="">
    <meta name="description" content="">

    <!--[if lt IE 9]>
    <meta http-equiv="refresh" content="0;ie.html" />
    <![endif]-->

    <link rel="shortcut icon" href="favicon.ico"> <link href="__HADMIN__/css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="__HADMIN__/css/font-awesome.min.css?v=4.4.0" rel="stylesheet">
    <link href="__HADMIN__/css/animate.css" rel="stylesheet">
    <link href="__HADMIN__/css/style.css?v=4.1.0" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="__HADMIN__/css/plugins/dataTables/dataTables.bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="__HADMIN__/css/plugins/sweetalert/sweetalert.css"/>
    <link rel="stylesheet" type="text/css" href="__HADMIN__/css/plugins/summernote/summernote.css"/>
    <link rel="stylesheet" type="text/css" href="__HADMIN__/css/plugins/summernote/summernote-bs3.css"/>
    <link rel="stylesheet" type="text/css" href="__HADMIN__/css/plugins/uploadify/uploadify.css"/>
    <include file="Home@Layout/preFunction" />
    <!--<link rel="stylesheet" type="text/css" href="__HADMIN__/js/plugins/fileinput/css/fileinput.css"/>-->
    <!--<link rel="stylesheet" type="text/css" href="__HADMIN__/js/plugins/fileinput/css/normalize.css"/>-->
    <style>
        /*重置sb-admin箭头样式*/
        .table.dataTable thead .sorting_asc:after,
        .table.dataTable thead .sorting_desc:after,
        .table.dataTable thead .sorting:after{
            content: "";
        }
        #ul1 {position:relative; margin:10px auto;}
        #ul1 li {width:18%; float:left; list-style:none; margin:10px;}
        #ul1 li:hover{ border-color: #9a9fa4; box-shadow: 0 0 6px 0 rgba(0, 0, 0, 0.85);}
        #ul1 .active{ border:1px dashed red;}
        .swal2-cancel
        {
            padding: 6px 15px !important;
            font-size: 20px !important;
            margin-left: 25px !important;
        }
        .swal2-confirm
        {
            padding: 6px 15px !important;
            font-size: 20px !important;
            margin-right: 25px !important;
        }


    </style>
</head>
<body>
<block name="content">
    <div class="row">
        <div class="col-lg-12">
            <h1 class="page-header"style="margin-left: 20px">管理Banner</h1>
        </div><!-- /.col-lg-12 -->
    </div><!-- /.row -->
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="clearfix">
                        <form action="" class="form-inline">
                            <div class="form-group">
                                <span class="control-label">请选择语言类型：</span>
                                <select id="dateSearch" class="form-control">
                                    <option value="" >全部</option>
                                    <option value="ZH">中文</option>
                                    <option value="EN">英文</option>
                                </select>
                            </div>
                            <button type="button" class="btn btn-outline btn-primary pull-right"   id="addGroup">新增Banner</button>
                            <button type="button" class="btn btn-outline btn-primary pull-right"   id="kBtnListorder"style="margin-right: 30px;">Banner排序</button>
                        </form>
                    </div>
                </div><!-- /.panel-heading -->
                <div class="panel-body">
                    <table width="100%" class="table table-striped table-bordered table-hover KTable" id="applicationInfo" style="text-align: center;">
                        <thead>
                        <tr style="text-align: center;">
                            <!--<th width="10%">申请类型</th>-->
                            <th width="35%">图片</th>
                            <th >语言</th>
                            <th >描述</th>
                            <th >链接</th>
                            <th>上传时间</th>
                            <th>排序</th>
                            <th>点击量</th>
                            <th>状态</th>
                            <th >操作</th>
                        </tr>
                        </thead>
                        <tbody>

                        </tbody>
                    </table><!-- /.table-responsive -->
                </div><!-- /.panel-body -->
            </div><!-- /.panel -->
        </div><!-- /.col-lg-12 -->
    </div><!-- /.row -->
    <!--模态框-->
    <!--新增编辑-->
    <div class="modal fade" id="applicationInfomodelOperationID" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none; font-size: 18px">
        <div class="modal-dialog  modal-lg "style="width: 50%">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h2 class="modal-title" id=""style="text-align: center">新增Banner</h2>
                </div>
                <div class="modal-body">
                    <form id="applicationInfomodelOperationFormID" class="form-horizontal clearfix" role="form" >
                        <div class="form-group">
                            <label for="kInputUploader" class="col-sm-3 control-label">上传Banner：</label>
                            <div class="col-sm-8" id="message">
                                <div class="col-sm-10"style="border: solid 1px #000000;height: 300px">
                                    <!--展示缩略图-->
                                    <img src="" alt=""id="kImgShowThumb" height="100%" width="100%" style="display: none;">
                                    <!--封面图字段-->
                                    <input type="hidden"name="pic_url"id="kInputImagePath">
                                </div>
                                <div class="col-sm-7" id="images" style="margin-top: 20px">
                                    <input type="file" id="kInputUploader">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="zh-input" class="col-sm-3 control-label">设置语言：</label>
                            <div class="col-sm-4" style="margin-top: 4px;">
                                <input name="language" type="radio" value="ZH"  id="zh-input" checked/>中文
                                <input name="language" type="radio" value="EN"  id="en-input" style="margin-left:15%"/>英文
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="description" class="col-sm-3 control-label">描述(选填)：</label>
                            <div class="col-sm-4" style="margin-top: 4px;">
                                <input type="text" class="form-control" id="description" name="description" placeholder="请输入描述" style="margin-top: 4px;">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="link" class="col-sm-3 control-label">链接地址：</label>
                            <div class="col-sm-4" style="margin-top: 4px;">
                                <input type="text" class="form-control" id="link" name="link" placeholder="请输入链接地址" style="margin-top: 4px;">
                            </div><span style="color: red;float: left;margin-top: 12px" id="linkError"></span>
                        </div>
                        <div class="form-group">
                            <label for="status" class="col-sm-3 control-label">选择状态：</label>
                            <div class="col-sm-4" style="margin-top: 4px;" id="is_show_on_mains">
                                <select class="form-control " id="status" name="status">
                                    <option value="0">显示</option>
                                    <option value="1">隐藏</option>
                                </select>
                            </div>
                        </div>
                        <div id="hidden"></div>
                    </form>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="modelOperationFormSubmitID">提交</button>
                    <!--<a href="/ElevatorMaintenanceCloudPlatform/index.php/Maintenance/PropertyContract/ajaxUploadImage" title="上传选中文件" class="btn btn-default kv-fileinput-upload fileinput-upload-button"><i class="glyphicon glyphicon-upload"></i> 上传</a>-->
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="ryModelOperation" style="display: none;">
        <div class="modal-dialog modal-lg" style="width: 75%">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h2 class="modal-title" style="text-align: center">轮播排序</h2>
                </div>
                <div class="modal-body" style="height: 500px" id="banner">
                </div>
                <div class="modal-footer">
                    <button type="button" id="kBtnAlertSubmit" class="btn btn-primary">确认修改</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                </div>

            </div>
        </div>
    </div>
    <div class="modal fade" id="ryModelOperations" style="display: none;font-size: 18px">
        <div class="modal-dialog modal-lg" >
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h2 class="modal-title" style="text-align: center">选择要排序的Banner</h2>
                </div>
                <div class="modal-body" >
                    <form id="alertStatus">
                        <div class="form-group">
                            <label for="status" class="col-sm-3 control-label">选择语言：</label>
                            <div class="col-sm-4" style="margin-top: -4px;" >
                                <select class="form-control " id="language" name="language">
                                    <option value="EN">英文</option>
                                    <option value="ZH">中文</option>
                                </select>
                            </div>
                        </div>
                        <div id="hiddenId"></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" id="kAlertSubmit" class="btn btn-primary">确认</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                </div>

            </div>
        </div>
    </div>
</block>
<!-- 全局js -->
<script src="__HADMIN__/js/jquery.min.js?v=2.1.4"></script>
<script src="__HADMIN__/js/move.js"></script>
<script src="__HADMIN__/js/bootstrap.min.js?v=3.3.6"></script>
<script src="__HADMIN__/js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="__HADMIN__/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
<script src="__HADMIN__/js/plugins/dataTables/jquery.dataTables.js"></script>
<script src="__HADMIN__/js/plugins/dataTables/dataTables.bootstrap.js"></script>
<script src="__HADMIN__/js/plugins/sweetalert/sweetalert.min.js"></script>
<!--ueditor副文本编辑器-->
<script src="__HADMIN__/js/plugins/summernote/summernote.min.js"></script>
<script src="__HADMIN__/js/plugins/summernote/summernote-zh-CN.js"></script>
<!-- 自定义js -->
<!-- 第三方插件 -->
<script src="__HADMIN__/js/plugins/pace/pace.min.js"></script>

<!--<script src="__HADMIN__/js/plugins/fileinput/js/fileinput.js" type="text/javascript"></script>-->
<script src="__HADMIN__/css/plugins/uploadify/jquery.uploadify.js" type="text/javascript"></script>
<!--<script src="__HADMIN__/js/plugins/fileinput/js/fileinput_locale_zh.js" type="text/javascript"></script>-->
</body>
<script type="text/javascript">
    var language='';
    var oTable;
    $(document).ready(function() {
        var tableHeight = document.body.clientHeight * 0.65 + 'px';
        oTable = $('#applicationInfo').dataTable({
            "aaSorting": [
                [5, "asc"]
            ],
            "responsive": true,
            "bProcessing": true,
            "sPaginationType": "full_numbers",
            "bDestory": false,
            "bRetrieve": false,
//            "searching":false,
//            "paging":false,
            "dom": '<"top"l<"toolbar">f>rt<"bottom"ip><"clear">',
            /*每页数量*/
            "aLengthMenu": [[10, 35, 50, -1], ["10条", "35条", "50条", "全部"]],//二组数组，第一组数量，第二组说明文字;
            /*垂直滚动条*/
            "scrollY":tableHeight,
            /*自定义语言*/
            "oLanguage": {
                "sProcessing": "正在加载数据...",
                "sLengthMenu": "每页显示 _MENU_ 条记录",
//                    "sZeroRecords": "抱歉， 没有找到",
                "sInfo": "从 _START_ 到 _END_ /共 _TOTAL_ 条数据&nbsp&nbsp&nbsp",
                "sInfoEmpty": "没有数据",
                "sInfoFiltered": "(从 _MAX_ 条数据中检索)",
                "sZeroRecords": "还未有Banner！！",
                "sSearch": "搜索 ",
                "oPaginate": {
                    "sFirst": "首页",
                    "sPrevious": "前一页",
                    "sNext": "后一页",
                    "sLast": "尾页"
                },
            },
            /*请求方法*/
            "sAjaxSource": "__URL__/selectBanner",
            /*向后台传参*/
            "fnServerParams": function (aoData) {
                aoData.push({
                    "name": "language",
                    "value": language,
                });
            },
            /*列，mData的个数要与html中的td一致*/
            "aoColumns": [
                {
                    "data":"pic_url",
                    "defaultContent":"",
//                        "type":"contract_id",
                    "render":function(data){

                        return  '<img src="'+data+'" width="95%"/> '
                    }
                },
                {
                    "data":"language",
//                        "type":"contract_id",
                    "render":function(data){

                        if(data == 'EN')
                        {
                            return '英文'
                        }else
                        {
                            return '中文';
                        }
                    }
                },
                {
                    "data":"description",
//                        "type":"contract_id",
                    "render":function(data){

                        if(data == '')
                        {
                            return '无描述'
                        }else
                        {
                            return data;
                        }
                    }
                },
                {"mData": "link"},
                {"mData": "upload_time"},
                {"mData": "banner_order"},
                {"mData": "click_rate"},
                {
                    "data":"status",
                    "defaultContent":"",
//                        "type":"contract_id",
                    "render":function(data){
                        if(data == 0)
                        {
                            return data = '<button type="button" class="btn btn-success" id="show-caocuo" attr-id="'+data+'">已显示</button>';
                        }
                        else
                        {
                            return  data = '<button type="button" class="btn btn-warning" id="delete-caocuo" attr-id="'+data+'">已隐藏</button>';
                        }


                    }
                },
                {
                    "data":"status",
                    "defaultContent":"",
//                        "type":"contract_id",
                    "render":function(data){
                        if(data == 0)
                        {
                            return data = '<button id="deleteMessage" type="button" class="btn btn-danger" disabled>隐藏后删除</button>';
                        }
                        else
                        {
                            return  data = '<button id="deleteMessage" type="button" class="btn btn-danger">删除</button>';
                        }
//                        return  '<button type="button"  id="AlertMessage" class="btn btn-success">修改</button> ' +
                    }
                },

            ],

        });
    });

    $('#addGroup').click(function () {
        $("#applicationInfomodelOperationID").modal();
        $('#banner_order option[value=1]').remove();

    })
    $('.table').on('click','#show-caocuo',function () {
        $(".table tr").removeClass('selected');
        $(this).parent().parent().addClass('selected');
//        alert('asdasd')

        swal({
            title: '确认隐藏图片?',
            type: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#DD6B55',
            cancelButtonColor: '#d33',
            confirmButtonText: '确认隐藏',
            cancelButtonText: '取消删除',
//                cancelButtonText：'取消删除'
        },function() {
            loading.add();
            var arr = getDataTablesSelectedData('applicationInfo');
            var postData = {};
            postData['banner_id']=arr[0].banner_id;
            postData['status'] = 1;
//            console.log(postData);
            $.ajax({
                type:'post',
                url:"__URL__/alertStatus",
                data:postData,
                dataType:'json',
                success:function(result){
//                console.log(result);
                    loading.remove();
                    $("#ryModelOperations").modal('hide');
                    oTable.api().ajax.reload();

                },
            });
        });

    });
    $('.table').on('click','#delete-caocuo',function () {
        $(".table tr").removeClass('selected');
        $(this).parent().parent().addClass('selected');
        var arr = getDataTablesSelectedData('applicationInfo');
        var postData = {};
        postData['language'] = arr[0].language;
        $.ajax({
            type:'post',
            url:"__URL__/selectBanners",
            data:postData,
            dataType:'json',
            success:function(result){
               var res = result.msg
                if(res.length == 5)
                {
                   return swal({
                        title: '已超过允许展示的上限!',
                        text: '请重试！',
                        type: 'warning',
                        timer: 3000
                    })
                }else
                {
                    swal({
                        title: '确认显示图片?',
                        type: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#DD6B55',
                        cancelButtonColor: '#d33',
                        confirmButtonText: '确认展示',
                        cancelButtonText: '取消删除',
//                cancelButtonText：'取消删除'
                    },function() {
                        loading.add();

                        var postData = {};
                        postData['banner_id']=arr[0].banner_id;
                        postData['status'] = 0;
                        $.ajax({
                            type:'post',
                            url:"__URL__/alertStatus",
                            data:postData,
                            dataType:'json',
                            success:function(result){
                                loading.remove();
                                $("#ryModelOperations").modal('hide');
                                oTable.api().ajax.reload();

                            },
                        });
                    });
                }

            },
        });
    });
    $('#kInputUploader').click(function () {
        loading.add();
    })
    //图片上传插件
    $('#kInputUploader').uploadify({
        'swf':'__HADMIN__/css/plugins/uploadify/uploadify.swf',
        'uploader':'__URL__/ajaxUploadImage',
        'buttonText':'上传图片',
        'fileTypeExts':'*.gif;*.png;*.jpg',
        'fileTypeDecs':'Image File',
        'fileObjName':'file',
        'fileSizeLimit': '5MB',
        'onUploadSuccess':function (file,data,response) {
            // console.log(data);loading.add();
            if(response)
            {
                var res = JSON.parse(data);
                // console.log(res.image_path);
                $('#kImgShowThumb').attr('src',res.image_path).show();
                $('#kInputImagePath').attr('value',res.image_path);
            }
        },
    });

    $('#dateSearch').change(function () {
        var product = $('#dateSearch').val();
        language = product;
        oTable.api().ajax.reload();
    })
    //点击修改按钮事件
    $('.table').on('click','#AlertMessage',function () {
        $('#ryModelOperations').modal();
        $(".table tr").removeClass('selected');
        $(this).parent().parent().addClass('selected');
        var arr = getDataTablesSelectedData('applicationInfo');
        for (var i =0;i<$('#Kstatus option').length;i++)
        {
            if($('#Kstatus option').eq(i).val() == arr[0].status)
            {
                $('#Kstatus option').eq(i).attr('selected',true)
            }
        }
        $.ajax({
            type:'post',
            url:"__URL__/selectBanners",
            dataType:'json',
            success:function(result){
                console.log(result);
                var res = result.msg
                if(res.length == 5)
                {
                    if(arr[0].status == 1)
                    {
                        $('#Kstatus').attr('disabled',true);
                    }
                }
                for(var i =0;i<res.length;i++)
                {
                    $('#banner_order option[value='+res[i].banner_order+']').remove();
//                    console.log(res[i]);
                }
            },
        });
        $('#hiddenId').append('<input type="hidden" value="'+arr[0].banner_id+'" name="banner_id">');
    })
    $('#kAlertSubmit').click(function () {
        var formData = $('#alertStatus').serializeArray()
        var postData = {};
        $(formData).each(function (i) {
            postData[this.name] = this.value;
        });
//       console.log(postData);
        $.ajax({
         type:'post',
         url:"__URL__/bannerImage",
         data:postData,
         dataType:'json',
         success:function(result){
             $('#ryModelOperations').modal('hide');
//                console.log(result);
            var res = result.msg;
            var sOut = ' <form id="k-form-image"><ul id="ul1">';
//                console.log(res);
            for( var i=0;i<res.length;i++){
//                    console.log(res[i]);
                sOut+='<li><img src="'+res[i].pic_url+'" width="100%" />'+'<input type="hidden" name="id" value="'+res[i].banner_id+'"></li>';
            }
            sOut+='</ul></form>';
//                console.log(sOut);
            $('#banner').html(sOut);
        },
    });
    $('#ryModelOperation').modal();
    //             window.onload = function() {
    setTimeout(function () {
        var oUl= document.getElementById("ul1");
        var aLi = oUl.getElementsByTagName("li");
        var disX = 0;
        var disY = 0;
        var minZindex = 1;
        var aPos =[];
        for(var i=0;i<aLi.length;i++){
            var t = aLi[i].offsetTop;
            var l = aLi[i].offsetLeft;
            aLi[i].style.top = t+"px";
            aLi[i].style.left = l+"px";
            aPos[i] = {left:l,top:t};
            aLi[i].index = i;
        }
        for(var i=0;i<aLi.length;i++){
            aLi[i].style.position = "absolute";
            aLi[i].style.margin = 0;
            setDrag(aLi[i]);

        }
        //拖拽
        function setDrag(obj){
            obj.onmouseover = function(){
                obj.style.cursor = "move";
            }
            obj.onmousedown = function(event){
                var scrollTop = document.documentElement.scrollTop||document.body.scrollTop;
                var scrollLeft = document.documentElement.scrollLeft||document.body.scrollLeft;
                obj.style.zIndex = minZindex++;
                //当鼠标按下时计算鼠标与拖拽对象的距离
                disX = event.clientX +scrollLeft-obj.offsetLeft;
                disY = event.clientY +scrollTop-obj.offsetTop;
                document.onmousemove=function(event){
                    //当鼠标拖动时计算div的位置
                    var l = event.clientX -disX +scrollLeft;
                    var t = event.clientY -disY + scrollTop;
                    obj.style.left = l + "px";
                    obj.style.top = t + "px";
                    /*for(var i=0;i<aLi.length;i++){
                     aLi[i].className = "";
                     if(obj==aLi[i])continue;//如果是自己则跳过自己不加红色虚线
                     if(colTest(obj,aLi[i])){
                     aLi[i].className = "active";
                     }
                     }*/
                    for(var i=0;i<aLi.length;i++){
                        aLi[i].className = "";
                    }
                    var oNear = findMin(obj);
                    if(oNear){
                        oNear.className = "active";
                    }

                }
                document.onmouseup = function(){
                    document.onmousemove = null;//当鼠标弹起时移出移动事件
                    document.onmouseup = null;//移出up事件，清空内存
                    //检测是否普碰上，在交换位置
                    var oNear = findMin(obj);
                    if(oNear){
                        oNear.className = "";
                        oNear.style.zIndex = minZindex++;
                        obj.style.zIndex = minZindex++;
                        startMove(oNear,aPos[obj.index]);
                        startMove(obj,aPos[oNear.index]);
                        //交换index
                        oNear.index += obj.index;
                        obj.index = oNear.index - obj.index;
                        oNear.index = oNear.index - obj.index;
                    }else{

                        startMove(obj,aPos[obj.index]);
                    }

                }

                clearInterval(obj.timer);
                return false;//低版本出现禁止符号
            }
        }
        //碰撞检测
        function colTest(obj1,obj2){
            var t1 = obj1.offsetTop;
            var r1 = obj1.offsetWidth+obj1.offsetLeft;
            var b1 = obj1.offsetHeight+obj1.offsetTop;
            var l1 = obj1.offsetLeft;

            var t2 = obj2.offsetTop;
            var r2 = obj2.offsetWidth+obj2.offsetLeft;
            var b2 = obj2.offsetHeight+obj2.offsetTop;
            var l2 = obj2.offsetLeft;

            if(t1>b2||r1<l2||b1<t2||l1>r2){
                return false;
            }else{
                return true;
            }
        }
        //勾股定理求距离
        function getDis(obj1,obj2){
            var a = obj1.offsetLeft-obj2.offsetLeft;
            var b = obj1.offsetTop-obj2.offsetTop;
            return Math.sqrt(Math.pow(a,2)+Math.pow(b,2));
        }
        //找到距离最近的
        function findMin(obj){
            var minDis = 999999999;
            var minIndex = -1;
            for(var i=0;i<aLi.length;i++){
                if(obj==aLi[i])continue;
                if(colTest(obj,aLi[i])){
                    var dis = getDis(obj,aLi[i]);
                    if(dis<minDis){
                        minDis = dis;
                        minIndex = i;
                    }
                }
            }

            if(minIndex==-1){
                return null;
            }else{
                return aLi[minIndex];
            }
        }

    },500)
    })

    //Banner排序
    $('#kBtnListorder').click(function () {
        $('#ryModelOperations').modal();

    });
    //确认修改顺序
    $('#kBtnAlertSubmit').click(function () {
        $("#ryModelOperation").modal('hide');
        loading.add();
        $('ul#ul1 li').each(function (i) {
            var a =$(this).css('left').substring(0,$(this).css('left').length-2);
            var b = Math.ceil(a/220);
            $(this).children('img').attr('attr-num',b);
        });
        var postData ={};
        $('ul#ul1 li').each(function (i) {
            postData[i] =$(this).children('input').val()+','+ $(this).children('img').attr('attr-num');
        });
        $.ajax({
            method:'post',
            url:'__URL__/imageSort',
            data:postData,
            dataType:'json',
            success:function (result) {
                loading.remove();
//                    console.log(result);
                if(result.status == 0)
                {
                    oTable.api().ajax.reload();
                }

            }

        });
    });
    //点击查看详情按钮事件
    $('.table').on('click','#SelectMessage',function () {
        $('#selectMessages').modal();
        $(".table tr").removeClass('selected');
        $(this).parent().parent().addClass('selected');
        var arr = getDataTablesSelectedData('applicationInfo');
        console.log(arr[0]);
        $('#kImgShow').attr('src',arr[0].main_pic).show();
        $('#productype').html(arr[0].product_type);
        $('#productnames').html(arr[0].product_name);
        $('#productnums').html(arr[0].product_num);
        $('#product_detail').html(arr[0].product_detail);



    })
    //删除Banner
    $('.table').on('click','#deleteMessage',function () {
        $(".table tr").removeClass('selected');
        $(this).parent().parent().addClass('selected');

        swal({
            title: '是否确认删除?',
            text: "删除以后将无法恢复!",
            type: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#DD6B55',
            cancelButtonColor: '#d33',
            confirmButtonText: '确认删除',
            cancelButtonText: '取消删除',
//                cancelButtonText：'取消删除'
        },function() {
            loading.add();
            var arr = getDataTablesSelectedData('applicationInfo');
            var postData = {};
            postData['banner_id']=arr[0].banner_id;
            console.log(postData);
            $.ajax({
                type:'post',
                data:postData,
                url:"__URL__/deleteBanner",
                dataType:'json',
                success:function(result){
//                    console.log(result);
                    loading.remove();
                    if (result.status == 0)
                    {
//                        $("#applicationInfomodelOperationID").modal('hide');
                        oTable.api().ajax.reload();
                    }
                    else
                    {
                        swal({
                            title: '删除失败!',
                            text: '请重试！',
                            type: 'warning',
                            timer: 3000
                        })
                    }
                },
            });
        });

    });
    $("#applicationInfomodelOperationID").on('hidden.bs.modal', function () {
        $('#hidden').html('');
        $('#kInputImagePath').val('');
        $('#kImgShowThumb').attr('src','').hide();
        $('#description').val('');
        $('#link').val('');
        $('#banner').html('');
    });
    $("#ryModelOperations").on('hidden.bs.modal', function () {
        $('#Kstatus').attr('disabled',false);
        $('#Kstatus option').prop('selected',false);
    });

    $('#dateSearch').change(function () {
        var product = $('#dateSearch').val();
        productType = product;
        oTable.api().ajax.reload();
    })

    //获取表格中值
    function getDataTablesSelectedData(element){
        var res = [];
        for(var i=0 ;i< $('#'+element).DataTable().rows('.selected').data().length;i++){
            res[i] = $('#'+element).DataTable().rows('.selected').data()[i];
        }
        return res;
    }
    $('#modelOperationFormSubmitID').click(function () {
        var formData =  $('#applicationInfomodelOperationFormID').serializeArray();
        var postData = {};
        $(formData).each(function (i) {
            postData[this.name] = this.value;
        });
//        var tex=$('#add_fwb').code();
//        console.log(postData);
        if(postData['link'] == '')
        {
            return $('#linkError').html('*请输入链接地址');
        }
        loading.add();
        $.ajax({
            type:'post',
            data:postData,
            url:"__URL__/addBannerManage",
            dataType:'json',
            success:function(result){
//                    console.log(result);
                loading.remove();
                if (result.status == 0)
                {
                    $("#applicationInfomodelOperationID").modal('hide');
                    oTable.api().ajax.reload();
                }else if(result.status == 2)
                {
                    loading.remove();
                    swal({
                        title: '超过允许设置的上限!',
                        text: '请重试！',
                        type: 'warning',
                        timer: 3000
                    })
                }
                else
                {
                    loading.remove();
                    swal({
                        title: '添加失败!',
                        text: '请重试！',
                        type: 'warning',
                        timer: 3000
                    })
                }
            },
        });
    })

</script>
</html>
